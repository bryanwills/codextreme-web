---
import { useTranslations } from "@/i18n/utils";
import { languageList } from "@/i18n/ui";

const currentLang = Astro.currentLocale || "en";
const t = useTranslations(currentLang as keyof typeof languageList);
---

<div
  id="cookie-banner"
  class="fixed bottom-4 left-1/2 -translate-x-1/2 w-[95%] max-w-3xl bg-white dark:bg-[#1A1A1A] rounded-lg border border-gray-200 dark:border-white/10 shadow-xl z-[60] transform translate-y-[150%] transition-transform duration-500"
>
  <div class="p-4">
    <div class="flex flex-col md:flex-row items-center gap-4">
      <!-- Icon & Text -->
      <div class="flex-1 flex items-start md:items-center gap-3">
        <span class="text-2xl shrink-0">üç™</span>
        <div class="text-xs text-gray-600 dark:text-gray-300 leading-relaxed">
          <span
            class="font-bold text-gray-900 dark:text-white block md:inline mb-1 md:mb-0 mr-1"
            >{t("cookies.title")}:</span
          >
          {t("cookies.message")}
          <a
            href="#"
            class="text-[#2563EB] hover:underline font-bold ml-1 whitespace-nowrap"
            >{t("cookies.more_info")}</a
          >
        </div>
      </div>

      <!-- Buttons -->
      <div
        class="flex flex-wrap md:flex-nowrap gap-2 w-full md:w-auto shrink-0"
      >
        <button
          id="accept-cookies"
          class="px-4 py-1.5 bg-[#2563EB] hover:bg-[#1D4ED8] text-white font-bold rounded-md transition-colors text-xs flex-1 md:flex-none text-center shadow-sm"
        >
          {t("cookies.accept_all")}
        </button>
        <button
          id="reject-cookies"
          class="px-4 py-1.5 bg-gray-100 dark:bg-white/5 hover:bg-gray-200 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300 font-bold rounded-md transition-colors text-xs flex-1 md:flex-none text-center border border-gray-200 dark:border-white/5"
        >
          {t("cookies.reject_all")}
        </button>
        <button
          id="customize-cookies"
          class="px-4 py-1.5 border border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-white/5 font-bold rounded-md transition-colors text-xs flex-1 md:flex-none text-center"
        >
          {t("cookies.customize")}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const cookieBanner = document.getElementById("cookie-banner");
  const acceptBtn = document.getElementById("accept-cookies");
  const rejectBtn = document.getElementById("reject-cookies");
  const customizeBtn = document.getElementById("customize-cookies");

  const COOKIE_CONSENT_KEY = "codextreme_cookie_consent";

  // Check if consent is already given
  const checkConsent = () => {
    const consent = localStorage.getItem(COOKIE_CONSENT_KEY);
    if (!consent) {
      // Show banner with a slight delay for animation
      setTimeout(() => {
        cookieBanner?.classList.remove("translate-y-[150%]");
      }, 1000);
    }
  };

  const saveConsent = (value: string) => {
    localStorage.setItem(COOKIE_CONSENT_KEY, value);
    cookieBanner?.classList.add("translate-y-[150%]");
  };

  acceptBtn?.addEventListener("click", () => saveConsent("accepted"));
  rejectBtn?.addEventListener("click", () => saveConsent("rejected"));

  // For now, customize behaves like accept or just closes,
  // as full customization logic would require more complex state management
  customizeBtn?.addEventListener("click", () => {
    // Placeholder for customization logic
    alert("Customization options would appear here.");
  });

  // Initialize
  checkConsent();
</script>
