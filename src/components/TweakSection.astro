---
interface Subsection {
  title: string;
  content?: string;
  command?: string;
  language?: string;
  type?: "warning" | "note" | "info";
}

interface Tweak {
  id: string;
  name: string;
  description: string;
  benefit: string;
  impact: string;
  subsections: Subsection[];
}

interface Props {
  tweaks: Tweak[];
  title: string;
  icon: string;
  color: string;
  textColor: string;
}

const { tweaks, title, icon, color, textColor } = Astro.props;

const impactColors: Record<string, string> = {
  low: "bg-emerald-500/10 text-emerald-400 border-emerald-500/20",
  medium: "bg-amber-500/10 text-amber-400 border-amber-500/20",
  high: "bg-rose-500/10 text-rose-400 border-rose-500/20",
};

const impactLabels: Record<string, string> = {
  low: "Low Impact",
  medium: "Medium Impact",
  high: "High Impact",
};
---

<div class="my-12 space-y-12">
  <!-- Category Header -->
  <div class={`relative overflow-hidden rounded-2xl p-8 md:p-12 bg-gradient-to-br ${color} shadow-2xl`}>
    <div class="absolute inset-0 bg-black/10 backdrop-blur-sm"></div>
    <div class="relative z-10 flex items-center gap-6">
      <div class="flex h-20 w-20 items-center justify-center rounded-2xl bg-white/10 backdrop-blur-md border border-white/20 shadow-inner text-5xl">
        {icon}
      </div>
      <div>
        <h2 class="text-4xl md:text-5xl font-bold text-white tracking-tight">
          {title}
        </h2>
        <p class="text-white/80 mt-2 text-lg font-medium">Optimization Category</p>
      </div>
    </div>
  </div>

  <div class="grid gap-8">
    {
      tweaks.map((tweak) => (
        <div class="group relative rounded-2xl bg-[#1A1A1A] border border-white/5 hover:border-white/10 transition-all duration-300 hover:shadow-2xl hover:shadow-black/50 overflow-hidden">

          <!-- Tweak Header -->
          <div class="relative p-6 md:p-8 border-b border-white/5 bg-white/[0.02]">
            <div class="flex flex-col md:flex-row md:items-start justify-between gap-4 mb-4">
              <h3 class="text-2xl font-bold text-white group-hover:text-blue-400 transition-colors">
                {tweak.name}
              </h3>
              <span
                class={`px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider border backdrop-blur-sm ${impactColors[tweak.impact] || impactColors.medium}`}
              >
                {(impactLabels[tweak.impact] as string) || "Medium"}
              </span>
            </div>

            <p class="text-gray-300 text-lg leading-relaxed mb-4">
              {tweak.description}
            </p>

            <div class="flex items-center gap-2 text-sm text-blue-300/90 bg-blue-500/10 px-4 py-2 rounded-lg w-fit border border-blue-500/20">
              <span class="text-lg">üí°</span>
              <span class="font-medium">{tweak.benefit}</span>
            </div>
          </div>

          <!-- Content Sections -->
          <div class="p-6 md:p-8 space-y-8 bg-[#141414]">
            {tweak.subsections.map((subsection) => (
              <div class="space-y-4">
                <h4 class="text-lg font-semibold text-white/90 flex items-center gap-2">
                  <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
                  {subsection.title}
                </h4>

                {subsection.content && (
                  <div
                    class={`p-5 rounded-xl border backdrop-blur-sm ${
                      subsection.type === "warning"
                        ? "bg-red-500/5 border-red-500/20 text-red-200"
                        : subsection.type === "note"
                          ? "bg-blue-500/5 border-blue-500/20 text-blue-200"
                          : subsection.type === "info"
                            ? "bg-amber-500/5 border-amber-500/20 text-amber-200"
                            : "bg-white/5 border-white/10 text-gray-300"
                    }`}
                  >
                    <div class="flex gap-3">
                      <span class="text-xl">
                        {subsection.type === "warning" ? "‚ö†Ô∏è" : subsection.type === "info" ? "‚ÑπÔ∏è" : subsection.type === "note" ? "üìù" : ""}
                      </span>
                      <div class="whitespace-pre-wrap leading-relaxed text-sm md:text-base">
                        {subsection.content}
                      </div>
                    </div>
                  </div>
                )}

                {subsection.command && (
                  <div class="relative group/cmd">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl opacity-20 group-hover/cmd:opacity-40 transition duration-500 blur"></div>
                    <div class="relative bg-[#0A0A0A] rounded-xl border border-white/10 overflow-hidden">
                      <div class="flex items-center justify-between px-4 py-2 bg-white/5 border-b border-white/5">
                        <span class="text-xs font-mono text-gray-500">PowerShell / CMD</span>
                        <button
                          class="copy-btn flex items-center gap-2 text-xs font-medium text-gray-400 hover:text-white transition-colors px-2 py-1 rounded hover:bg-white/10"
                          data-command={subsection.command}
                        >
                          <span class="icon">üìã</span>
                          <span class="text">Copy</span>
                        </button>
                      </div>
                      <div class="p-4 overflow-x-auto custom-scrollbar">
                        <code class="font-mono text-sm text-blue-300 whitespace-pre">
                          {subsection.command}
                        </code>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      ))
    }
  </div>
</div>

<style>
  .custom-scrollbar::-webkit-scrollbar {
    height: 8px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.2);
  }
</style>

<script>
  document.querySelectorAll(".copy-btn").forEach((btn: Element) => {
    btn.addEventListener("click", function (this: HTMLElement) {
      const command = this.getAttribute("data-command");
      const textSpan = this.querySelector(".text");
      const iconSpan = this.querySelector(".icon");

      if (command && textSpan && iconSpan) {
        navigator.clipboard.writeText(command).then(() => {
          const originalText = textSpan.textContent;
          const originalIcon = iconSpan.textContent;

          textSpan.textContent = "Copied!";
          iconSpan.textContent = "‚úì";
          this.classList.add("text-green-400");

          setTimeout(() => {
            textSpan.textContent = originalText;
            iconSpan.textContent = originalIcon;
            this.classList.remove("text-green-400");
          }, 2000);
        });
      }
    });
  });
</script>
